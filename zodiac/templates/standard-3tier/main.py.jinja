from fastapi import FastAPI
from zodiac_core.routing import APIRouter
from zodiac_core.logging import setup_loguru
from zodiac_core.middleware import register_middleware
from zodiac_core.exception_handlers import register_exception_handlers
from loguru import logger

# 1. Setup Standard Logging
setup_loguru(
    level="INFO",
    json_format=True,
    service_name="{{ project_name }}"
)

app = FastAPI(title="{{ project_name }}")

# 2. Register Global Middleware & Exception Handlers
register_middleware(app)
register_exception_handlers(app)

# 3. Standard Router (Automatic Response Wrapping)
router = APIRouter()

@router.get("/health")
async def health_check():
    logger.info("Health check triggered")
    return {"status": "healthy"}

app.include_router(router)
