
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A high-performance core library for modern Python web services.">
      
      
      
        <link rel="canonical" href="https://ttwshell.github.io/ZodiacCore-Py/0.3.0/user-guide/architecture/">
      
      
        <link rel="prev" href="../getting-started/">
      
      
        <link rel="next" href="../cli/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Architecture Guide - ZodiacCore-Py</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#architecture-guide" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ZodiacCore-Py" class="md-header__button md-logo" aria-label="ZodiacCore-Py" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ZodiacCore-Py
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Architecture Guide
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ZodiacCore-Py" class="md-nav__button md-logo" aria-label="ZodiacCore-Py" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    ZodiacCore-Py
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    User Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Basic Usage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Architecture Guide
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture Guide
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-this-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why This Architecture?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Layers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture Layers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#standard-3-tier-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Standard 3-Tier Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-api-presentation-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. API (Presentation Layer)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-application-business-logic-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Application (Business Logic Layer)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-infrastructure-implementation-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Infrastructure (Implementation Layer)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extended-4-tier-architecture-future" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extended 4-Tier Architecture (Future)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extended 4-Tier Architecture (Future)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-layer-4-tier" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Layer (4-Tier)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-layer-4-tier" class="md-nav__link">
    <span class="md-ellipsis">
      
        Application Layer (4-Tier)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-layer-future-addition" class="md-nav__link">
    <span class="md-ellipsis">
      
        Domain Layer - Future Addition
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infrastructure-layer-4-tier" class="md-nav__link">
    <span class="md-ellipsis">
      
        Infrastructure Layer (4-Tier)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependency-injection-container" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dependency Injection Container
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dependency Injection Container">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#container-definition" class="md-nav__link">
    <span class="md-ellipsis">
      
        Container Definition
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wiring" class="md-nav__link">
    <span class="md-ellipsis">
      
        Wiring
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#benefits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Benefits
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Flow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-tier-architecture-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        3-Tier Architecture Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-tier-architecture-flow-future" class="md-nav__link">
    <span class="md-ellipsis">
      
        4-Tier Architecture Flow (Future)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-flow-get-apiv1itemspage1size20-3-tier" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example Flow: GET /api/v1/items?page=1&amp;size=20 (3-Tier)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-keep-layers-independent" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Keep Layers Independent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-use-dependency-injection" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Use Dependency Injection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-repository-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Repository Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-service-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Service Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-response-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Response Schemas
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#choosing-your-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Choosing Your Architecture
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    zodiac CLI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/context/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Context & Tracing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/db/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/exceptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exception Handling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Logging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/middleware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Middleware
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/pagination/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pagination
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/routing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Routing & Response
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/schemas/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Schemas
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#why-this-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why This Architecture?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#architecture-layers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Architecture Layers
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Architecture Layers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#standard-3-tier-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Standard 3-Tier Architecture
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-api-presentation-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. API (Presentation Layer)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-application-business-logic-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Application (Business Logic Layer)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-infrastructure-implementation-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Infrastructure (Implementation Layer)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extended-4-tier-architecture-future" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extended 4-Tier Architecture (Future)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extended 4-Tier Architecture (Future)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#api-layer-4-tier" class="md-nav__link">
    <span class="md-ellipsis">
      
        API Layer (4-Tier)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#application-layer-4-tier" class="md-nav__link">
    <span class="md-ellipsis">
      
        Application Layer (4-Tier)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#domain-layer-future-addition" class="md-nav__link">
    <span class="md-ellipsis">
      
        Domain Layer - Future Addition
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infrastructure-layer-4-tier" class="md-nav__link">
    <span class="md-ellipsis">
      
        Infrastructure Layer (4-Tier)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependency-injection-container" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dependency Injection Container
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dependency Injection Container">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#container-definition" class="md-nav__link">
    <span class="md-ellipsis">
      
        Container Definition
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wiring" class="md-nav__link">
    <span class="md-ellipsis">
      
        Wiring
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#benefits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Benefits
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data Flow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3-tier-architecture-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        3-Tier Architecture Flow
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-tier-architecture-flow-future" class="md-nav__link">
    <span class="md-ellipsis">
      
        4-Tier Architecture Flow (Future)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-flow-get-apiv1itemspage1size20-3-tier" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example Flow: GET /api/v1/items?page=1&amp;size=20 (3-Tier)
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Best Practices
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-keep-layers-independent" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Keep Layers Independent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-use-dependency-injection" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Use Dependency Injection
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-repository-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Repository Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-service-layer" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Service Layer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-response-schemas" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Response Schemas
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#choosing-your-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      
        Choosing Your Architecture
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="architecture-guide">Architecture Guide</h1>
<p>This guide explains the <strong>Layered Architecture</strong> with <strong>Dependency Injection</strong> that ZodiacCore promotes for building maintainable, testable, and scalable FastAPI applications.</p>
<p>ZodiacCore recommends a <strong>3-tier architecture</strong> as the standard approach, but you can adapt it to your project's needs. This guide focuses on the 3-tier structure while also mentioning how to extend it to a 4-tier architecture when needed.</p>
<h2 id="why-this-architecture">Why This Architecture?</h2>
<p>The layered architecture with DI provides:</p>
<ul>
<li>✅ <strong>Separation of Concerns</strong>: Each layer has a clear responsibility</li>
<li>✅ <strong>Testability</strong>: Easy to mock dependencies and test in isolation</li>
<li>✅ <strong>Maintainability</strong>: Changes in one layer don't cascade to others</li>
<li>✅ <strong>Scalability</strong>: Easy to swap implementations (e.g., different databases)</li>
<li>✅ <strong>Team Collaboration</strong>: Clear boundaries for parallel development</li>
</ul>
<h2 id="architecture-layers">Architecture Layers</h2>
<p>ZodiacCore supports flexible layered architectures. The standard template uses a <strong>3-tier architecture</strong>, but you can extend it to a <strong>4-tier architecture</strong> when your application requires additional separation of concerns.</p>
<h3 id="standard-3-tier-architecture">Standard 3-Tier Architecture</h3>
<p>The recommended structure consists of three layers:</p>
<h3 id="1-api-presentation-layer">1. API (Presentation Layer)</h3>
<p><strong>Location</strong>: <code>app/api/</code></p>
<p><strong>Responsibilities</strong>:</p>
<ul>
<li>Handle HTTP requests and responses</li>
<li>Validate input data (Pydantic schemas)</li>
<li>Transform domain models to response schemas</li>
<li>Route requests to appropriate services</li>
</ul>
<p><strong>What it contains</strong>:</p>
<ul>
<li><strong>Routers</strong> (<code>app/api/routers/</code>): FastAPI route handlers</li>
<li><strong>Schemas</strong> (<code>app/api/schemas/</code>): Request/response Pydantic models</li>
</ul>
<p><strong>Example</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Annotated</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dependency_injector.wiring</span><span class="w"> </span><span class="kn">import</span> <span class="n">Provide</span><span class="p">,</span> <span class="n">inject</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">fastapi</span><span class="w"> </span><span class="kn">import</span> <span class="n">Depends</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">zodiac_core.pagination</span><span class="w"> </span><span class="kn">import</span> <span class="n">PagedResponse</span><span class="p">,</span> <span class="n">PageParams</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">zodiac_core.routing</span><span class="w"> </span><span class="kn">import</span> <span class="n">APIRouter</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">app.api.schemas.item_schema</span><span class="w"> </span><span class="kn">import</span> <span class="n">ItemSchema</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">app.application.services.item_service</span><span class="w"> </span><span class="kn">import</span> <span class="n">ItemService</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">app.core.container</span><span class="w"> </span><span class="kn">import</span> <span class="n">Container</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="n">router</span> <span class="o">=</span> <span class="n">APIRouter</span><span class="p">()</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">PagedResponse</span><span class="p">[</span><span class="n">ItemSchema</span><span class="p">])</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="nd">@inject</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_items</span><span class="p">(</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="n">page_params</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">PageParams</span><span class="p">,</span> <span class="n">Depends</span><span class="p">()],</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="n">service</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">ItemService</span><span class="p">,</span> <span class="n">Depends</span><span class="p">(</span><span class="n">Provide</span><span class="p">[</span><span class="n">Container</span><span class="o">.</span><span class="n">item_service</span><span class="p">])],</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="p">):</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;List items with pagination.&quot;&quot;&quot;</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>    <span class="k">return</span> <span class="k">await</span> <span class="n">service</span><span class="o">.</span><span class="n">list_items</span><span class="p">(</span><span class="n">page_params</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Key Points</strong>:</p>
<ul>
<li>Routers are <strong>thin</strong> - they delegate to services</li>
<li>Dependencies are injected via <code>dependency-injector</code></li>
<li>Response models are defined here (API contract)</li>
</ul>
<hr />
<h3 id="2-application-business-logic-layer">2. Application (Business Logic Layer)</h3>
<p><strong>Location</strong>: <code>app/application/</code></p>
<p><strong>Responsibilities</strong>:</p>
<ul>
<li>Implement business logic and use cases</li>
<li>Orchestrate operations across multiple repositories</li>
<li>Validate business rules</li>
<li>Handle domain-level exceptions</li>
</ul>
<p><strong>What it contains</strong>:</p>
<ul>
<li><strong>Services</strong> (<code>app/application/services/</code>): Business logic classes</li>
</ul>
<p><strong>Example</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">loguru</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">zodiac_core.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="n">NotFoundException</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">zodiac_core.pagination</span><span class="w"> </span><span class="kn">import</span> <span class="n">PagedResponse</span><span class="p">,</span> <span class="n">PageParams</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">app.infrastructure.database.models.item_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">ItemModel</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">app.infrastructure.database.repositories.item_repository</span><span class="w"> </span><span class="kn">import</span> <span class="n">ItemRepository</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">ItemService</span><span class="p">:</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_repo</span><span class="p">:</span> <span class="n">ItemRepository</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">item_repo</span> <span class="o">=</span> <span class="n">item_repo</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ItemModel</span><span class="p">:</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an item by ID, raising NotFoundException if not found.&quot;&quot;&quot;</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>        <span class="n">item</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_repo</span><span class="o">.</span><span class="n">get_by_id</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">:</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>            <span class="k">raise</span> <span class="n">NotFoundException</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Item id &#39;</span><span class="si">{</span><span class="n">item_id</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">)</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>        <span class="k">return</span> <span class="n">item</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page_params</span><span class="p">:</span> <span class="n">PageParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PagedResponse</span><span class="p">[</span><span class="n">ItemModel</span><span class="p">]:</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List items with pagination.&quot;&quot;&quot;</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_repo</span><span class="o">.</span><span class="n">list_items</span><span class="p">(</span><span class="n">page_params</span><span class="p">)</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>            <span class="n">page</span><span class="o">=</span><span class="n">page_params</span><span class="o">.</span><span class="n">page</span><span class="p">,</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>            <span class="n">size</span><span class="o">=</span><span class="n">page_params</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>            <span class="n">total</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">total</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>        <span class="p">)</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;list_items&quot;</span><span class="p">)</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>        <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div></p>
<p><strong>Key Points</strong>:</p>
<ul>
<li>Services contain <strong>business logic</strong>, not data access</li>
<li>Services depend on repositories (infrastructure), not the other way around</li>
<li>Business exceptions are raised here</li>
</ul>
<hr />
<h3 id="3-infrastructure-implementation-layer">3. Infrastructure (Implementation Layer)</h3>
<p><strong>Location</strong>: <code>app/infrastructure/</code></p>
<p><strong>Responsibilities</strong>:</p>
<ul>
<li>Implement data persistence (database, external APIs)</li>
<li>Provide concrete implementations of abstractions</li>
<li>Handle technical concerns (SQL queries, HTTP clients)</li>
</ul>
<p><strong>What it contains</strong>:</p>
<ul>
<li><strong>Database</strong> (<code>app/infrastructure/database/</code>):</li>
<li><strong>Models</strong> (<code>models/</code>): SQLModel table definitions</li>
<li><strong>Repositories</strong> (<code>repositories/</code>): Data access classes</li>
<li><strong>External</strong> (<code>app/infrastructure/external/</code>): Third-party API clients</li>
</ul>
<p><strong>Example - Repository</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">sqlalchemy</span><span class="w"> </span><span class="kn">import</span> <span class="n">select</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">zodiac_core.db.repository</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseSQLRepository</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">zodiac_core.pagination</span><span class="w"> </span><span class="kn">import</span> <span class="n">PagedResponse</span><span class="p">,</span> <span class="n">PageParams</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">app.infrastructure.database.models.item_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">ItemModel</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">ItemRepository</span><span class="p">(</span><span class="n">BaseSQLRepository</span><span class="p">):</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ItemModel</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get an item by ID.&quot;&quot;&quot;</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>            <span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">ItemModel</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ItemModel</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">item_id</span><span class="p">)</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">stmt</span><span class="p">)</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">scalar_one_or_none</span><span class="p">()</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="n">PageParams</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PagedResponse</span><span class="p">[</span><span class="n">ItemModel</span><span class="p">]:</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List items with pagination using BaseSQLRepository.paginate_query.&quot;&quot;&quot;</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>        <span class="n">stmt</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">ItemModel</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">ItemModel</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">paginate_query</span><span class="p">(</span><span class="n">stmt</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Example - External Client</strong>:
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">loguru</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">zodiac_core.http</span><span class="w"> </span><span class="kn">import</span> <span class="n">ZodiacClient</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">GitHubClient</span><span class="p">:</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="p">:</span> <span class="n">ZodiacClient</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_homepage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch GitHub homepage HTML.&quot;&quot;&quot;</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://github.com&quot;</span><span class="p">)</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Fetched GitHub homepage&quot;</span><span class="p">)</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span></code></pre></div></p>
<p><strong>Key Points</strong>:</p>
<ul>
<li>Repositories inherit from <code>BaseSQLRepository</code> for pagination and session management</li>
<li>External clients use <code>ZodiacClient</code> for HTTP requests with trace ID injection</li>
<li>Infrastructure is <strong>swappable</strong> - you can change databases or APIs without touching business logic</li>
</ul>
<hr />
<h2 id="extended-4-tier-architecture-future">Extended 4-Tier Architecture (Future)</h2>
<p>When your application grows in complexity, you may want to introduce a <strong>Domain Layer</strong> between the Application and Infrastructure layers. This creates a 4-tier architecture with stricter separation of concerns:</p>
<h3 id="api-layer-4-tier">API Layer (4-Tier)</h3>
<ul>
<li>Same as in 3-tier architecture</li>
<li>Handles HTTP requests and responses</li>
<li>Validates input data</li>
<li>Transforms domain entities to response schemas</li>
</ul>
<h3 id="application-layer-4-tier">Application Layer (4-Tier)</h3>
<ul>
<li><strong>Location</strong>: <code>app/application/</code></li>
<li><strong>Responsibilities</strong>:<ul>
<li>Orchestrates domain services and entities</li>
<li>Coordinates workflows and use cases</li>
<li>Handles application-level concerns (transactions, coordination)</li>
<li>Transforms between domain entities and infrastructure models</li>
</ul>
</li>
<li><strong>What it contains</strong>:<ul>
<li><strong>Services</strong> (<code>app/application/services/</code>): Use case orchestration classes</li>
<li><strong>DTOs</strong> (<code>app/application/dtos/</code>): Data transfer objects for application boundaries</li>
</ul>
</li>
<li><strong>Key Difference</strong>: In 4-tier, Application layer focuses on orchestration rather than business logic</li>
</ul>
<h3 id="domain-layer-future-addition">Domain Layer - <em>Future Addition</em></h3>
<ul>
<li><strong>Location</strong>: <code>app/domain/</code></li>
<li><strong>Responsibilities</strong>:<ul>
<li>Contains core business logic and domain models</li>
<li>Defines domain entities and value objects</li>
<li>Implements domain services</li>
<li>Enforces business rules and invariants</li>
<li>Defines repository interfaces (abstractions)</li>
</ul>
</li>
<li><strong>What it contains</strong>:<ul>
<li><strong>Entities</strong> (<code>app/domain/entities/</code>): Domain models with business logic</li>
<li><strong>Value Objects</strong> (<code>app/domain/value_objects/</code>): Immutable domain concepts</li>
<li><strong>Domain Services</strong> (<code>app/domain/services/</code>): Domain-specific operations</li>
<li><strong>Repository Interfaces</strong> (<code>app/domain/repositories/</code>): Abstract repository contracts</li>
</ul>
</li>
</ul>
<h3 id="infrastructure-layer-4-tier">Infrastructure Layer (4-Tier)</h3>
<ul>
<li>Same structure as in 3-tier architecture</li>
<li><strong>Key Difference</strong>: Implements domain repository interfaces defined in the Domain layer</li>
<li>Provides concrete implementations of domain abstractions</li>
</ul>
<p><strong>Note</strong>: The 4-tier architecture is not yet implemented in the standard template, but the structure is designed to accommodate this extension when needed. You can add the Domain layer as your application evolves.</p>
<hr />
<h2 id="dependency-injection-container">Dependency Injection Container</h2>
<p><strong>Location</strong>: <code>app/core/container.py</code></p>
<p>The DI container wires all layers together, managing the lifecycle and dependencies of components.</p>
<h3 id="container-definition">Container Definition</h3>
<p>The container is typically defined in <code>app/core/container.py</code>: it declares providers (Factory/Singleton) for repositories, services, and other infrastructure. Only the <strong>API layer</strong> (routers) needs to request dependencies via <code>Depends(Provide[Container.xxx])</code>; the container injects service → repository and other lower-layer dependencies when it constructs those objects.</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dependency_injector</span><span class="w"> </span><span class="kn">import</span> <span class="n">containers</span><span class="p">,</span> <span class="n">providers</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Container</span><span class="p">(</span><span class="n">containers</span><span class="o">.</span><span class="n">DeclarativeContainer</span><span class="p">):</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="n">config</span> <span class="o">=</span> <span class="n">providers</span><span class="o">.</span><span class="n">Configuration</span><span class="p">()</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    <span class="n">item_repository</span> <span class="o">=</span> <span class="n">providers</span><span class="o">.</span><span class="n">Factory</span><span class="p">(</span><span class="n">ItemRepository</span><span class="p">)</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    <span class="n">item_service</span> <span class="o">=</span> <span class="n">providers</span><span class="o">.</span><span class="n">Factory</span><span class="p">(</span><span class="n">ItemService</span><span class="p">,</span> <span class="n">item_repo</span><span class="o">=</span><span class="n">item_repository</span><span class="p">)</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="c1"># ...</span>
</span></code></pre></div>
<h3 id="wiring">Wiring</h3>
<p>With <strong>dependency-injector</strong>, only the modules that <strong>use</strong> <code>Depends(Provide[Container.xxx])</code> must be "wired" to the container — i.e. the API router modules. You call <code>container.wire(modules=[...])</code> at startup with the list of those module names (e.g. <code>"app.api.routers.item_router"</code>). That way, when a route runs and asks for <code>Container.item_service</code>, the container can resolve it.</p>
<p>Service and infrastructure layers do <strong>not</strong> need to be wired: they are created by the container via <code>providers.Factory(...)</code> and receive their dependencies in the constructor.</p>
<h3 id="benefits">Benefits</h3>
<ul>
<li><strong>Loose Coupling</strong>: Components don't create their dependencies</li>
<li><strong>Easy Testing</strong>: Mock dependencies in tests</li>
<li><strong>Configuration</strong>: Centralized dependency configuration</li>
<li><strong>Lifecycle Management</strong>: Singleton vs Factory patterns</li>
</ul>
<hr />
<h2 id="data-flow">Data Flow</h2>
<h3 id="3-tier-architecture-flow">3-Tier Architecture Flow</h3>
<p>Here's how a request flows through the 3-tier layers:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>HTTP Request
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>    ↓
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>[API Layer] Router receives request
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    ↓ (injects service)
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>[Application Layer] Service implements business logic
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    ↓ (uses repository)
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>[Infrastructure Layer] Repository queries database
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    ↓ (returns data)
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>[Application Layer] Service processes and returns
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>    ↓ (transforms to schema)
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>[API Layer] Router returns response
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>    ↓
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>HTTP Response
</span></code></pre></div>
<h3 id="4-tier-architecture-flow-future">4-Tier Architecture Flow (Future)</h3>
<p>In a 4-tier architecture, the flow includes the Domain layer:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>HTTP Request
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    ↓
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>[API Layer] Router receives request
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    ↓ (injects application service)
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>[Application Layer] Orchestrates use case
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    ↓ (uses domain service/entity)
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>[Domain Layer] Business logic and rules
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>    ↓ (uses repository interface)
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>[Infrastructure Layer] Implements repository, queries database
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>    ↓ (returns domain entity)
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>[Domain Layer] Processes domain logic
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>    ↓ (returns domain entity)
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>[Application Layer] Transforms to DTO
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>    ↓ (transforms to schema)
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a>[API Layer] Router returns response
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a>    ↓
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a>HTTP Response
</span></code></pre></div>
<h3 id="example-flow-get-apiv1itemspage1size20-3-tier">Example Flow: <code>GET /api/v1/items?page=1&amp;size=20</code> (3-Tier)</h3>
<ol>
<li><strong>Router</strong> (<code>item_router.py</code>):</li>
<li>Receives request with <code>PageParams</code></li>
<li>Injects <code>ItemService</code> from container</li>
<li>
<p>Calls <code>service.list_items(page_params)</code></p>
</li>
<li>
<p><strong>Service</strong> (<code>item_service.py</code>):</p>
</li>
<li>Receives <code>PageParams</code></li>
<li>Calls <code>item_repo.list_items(page_params)</code></li>
<li>Logs the operation</li>
<li>
<p>Returns <code>PagedResponse[ItemModel]</code></p>
</li>
<li>
<p><strong>Repository</strong> (<code>item_repository.py</code>):</p>
</li>
<li>Builds SQL query: <code>select(ItemModel).order_by(ItemModel.id)</code></li>
<li>Calls <code>paginate_query(stmt, params)</code></li>
<li>
<p>Returns <code>PagedResponse[ItemModel]</code></p>
</li>
<li>
<p><strong>Router</strong> (back):</p>
</li>
<li>Transforms <code>ItemModel</code> to <code>ItemSchema</code> (via response_model)</li>
<li>Returns wrapped response</li>
</ol>
<hr />
<h2 id="configuration">Configuration</h2>
<p><strong>Location</strong>: <code>config/</code></p>
<p>Configuration is managed through <code>.ini</code> files:</p>
<ul>
<li><code>config/app.ini</code> - Base configuration (all environments)</li>
<li><code>config/app.develop.ini</code> - Development overrides</li>
<li><code>config/app.production.ini</code> - Production overrides</li>
</ul>
<p>The container loads configuration:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">zodiac_core.config</span><span class="w"> </span><span class="kn">import</span> <span class="n">ConfigManagement</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="n">config_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;config&quot;</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="n">config_files</span> <span class="o">=</span> <span class="n">ConfigManagement</span><span class="o">.</span><span class="n">get_config_files</span><span class="p">(</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    <span class="n">search_paths</span><span class="o">=</span><span class="p">[</span><span class="n">config_dir</span><span class="p">],</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    <span class="n">env_var</span><span class="o">=</span><span class="s2">&quot;ENV&quot;</span><span class="p">,</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    <span class="n">default_env</span><span class="o">=</span><span class="s2">&quot;develop&quot;</span><span class="p">,</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="p">)</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="n">container</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_ini</span><span class="p">(</span><span class="o">*</span><span class="n">config_files</span><span class="p">)</span>
</span></code></pre></div>
<p>Access configuration in the container:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># In main.py lifespan</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">db_url</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">url</span><span class="p">()</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="n">db_echo</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">echo</span><span class="o">.</span><span class="n">as_</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
</span></code></pre></div>
<hr />
<h2 id="best-practices">Best Practices</h2>
<h3 id="1-keep-layers-independent">1. Keep Layers Independent</h3>
<ul>
<li>✅ API layer doesn't import from Infrastructure (in 3-tier)</li>
<li>✅ Application layer doesn't know about FastAPI</li>
<li>✅ Infrastructure layer doesn't contain business logic</li>
<li>✅ Domain layer (4-tier) doesn't depend on Infrastructure or Application layers</li>
</ul>
<h3 id="2-use-dependency-injection">2. Use Dependency Injection</h3>
<ul>
<li>✅ Inject dependencies via constructor</li>
<li>✅ Use the container to wire dependencies</li>
<li>❌ Don't create dependencies inside classes</li>
</ul>
<h3 id="3-repository-pattern">3. Repository Pattern</h3>
<ul>
<li>✅ Use <code>BaseSQLRepository</code> for database operations</li>
<li>✅ Use <code>paginate_query()</code> for pagination</li>
<li>✅ Keep repositories focused on data access</li>
</ul>
<h3 id="4-service-layer">4. Service Layer</h3>
<ul>
<li>✅ In 3-tier: Put business logic in application services</li>
<li>✅ In 4-tier: Put business logic in domain services/entities; application services orchestrate</li>
<li>✅ Services orchestrate repositories</li>
<li>✅ Raise domain exceptions (e.g., <code>NotFoundException</code>)</li>
</ul>
<h3 id="5-response-schemas">5. Response Schemas</h3>
<ul>
<li>✅ Define schemas in API layer</li>
<li>✅ Transform domain models to schemas</li>
<li>✅ Use Pydantic for validation</li>
</ul>
<hr />
<h2 id="summary">Summary</h2>
<p>The layered architecture with DI provides:</p>
<ul>
<li><strong>Clear separation</strong> between presentation, business logic, and data access</li>
<li><strong>Testability</strong> through dependency injection</li>
<li><strong>Maintainability</strong> through well-defined boundaries</li>
<li><strong>Scalability</strong> through swappable implementations</li>
<li><strong>Flexibility</strong> to adapt to your project's needs (3-tier or 4-tier)</li>
</ul>
<h3 id="choosing-your-architecture">Choosing Your Architecture</h3>
<ul>
<li><strong>Start with 3-tier</strong>: The standard template uses a 3-tier architecture, which is sufficient for most applications</li>
<li><strong>Extend to 4-tier</strong>: When you need stricter domain modeling and want to separate domain logic from application orchestration, you can introduce a Domain layer</li>
<li><strong>Not mandatory</strong>: ZodiacCore doesn't enforce a specific number of layers - choose what fits your project best</li>
</ul>
<p>This architecture is the foundation of the <code>standard-3tier</code> template generated by <code>zodiac new</code>. Start with the template and extend it as your application grows.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["content.code.copy", "content.code.annotate", "navigation.expand", "navigation.top", "navigation.tracking", "navigation.toc", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>